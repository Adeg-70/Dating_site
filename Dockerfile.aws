FROM node:18-alpine

WORKDIR /app

# Install dependencies
COPY package*.json ./
COPY server/package*.json ./server/
RUN npm ci --production --prefix server

# Copy application
COPY . .

# Add AWS-specific configuration
COPY config/aws.json ./config/

USER node

EXPOSE 5000

CMD ["npm", "run", "start:aws", "--prefix", "server"]